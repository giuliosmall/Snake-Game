'''This is our main working file'''

import csv
from turtle import Screen
import time
from snake import Snake
from food import Food
from scoreboard import Scoreboard
from configurator import Configurator

configurator = Configurator()
screen = Screen()
screen.setup(width=600, height=600)
screen.bgcolor(configurator.get_background())
screen.title("Snake Game")
screen.tracer(0)

# The Snake class creates and moves the snake body, allowing for keys control
snake = Snake()
# The Food class creates and reallocates the food when the snake eats it
food = Food()
# The Scoreboard class maintains the score and creates the scoreboard
scoreboard = Scoreboard()

screen.listen()

screen.onkey(snake.up, "Up")
screen.onkey(snake.down, "Down")
screen.onkey(snake.left, "Left")
screen.onkey(snake.right, "Right")

game_is_on = True
while game_is_on:
    screen.update()
    time.sleep(0.1)
    snake.move()

    # Detect collision with food
    if snake.head.distance(food) < 15:
        food.refresh()
        snake.extend()
        scoreboard.increase_score()

    # Detect collision with walls
    if snake.head.xcor() > 280 or snake.head.xcor() < -280:
        game_is_on = False
        scoreboard.game_over()
    elif snake.head.ycor() > 280 or snake.head.ycor() < -280:
        game_is_on = False
        scoreboard.game_over()

    # Detect collision with tail
    for segment in snake.segments[1:]:
        if snake.head.distance(segment) < 10:
            game_is_on = False
            scoreboard.game_over()


screen.exitonclick()  # Making the screen to not disappear straight away
